(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();const q=[{id:"kai",name:"Kai",element:"Ogie≈Ñ",color:"#C41E3A",emoji:"üî•",avatar:"/avatars/kai.svg",encouragements:["GorƒÖco! ≈öwietna robota!","P≈Çomienne obliczenia!","Ogie≈Ñ! Tak trzymaj!","Rozpalasz siƒô!"],comforts:["Nie poddawaj siƒô! Ogie≈Ñ nigdy nie ga≈õnie!","Spr√≥buj jeszcze raz, wojowniku!","Ka≈ºdy ninja siƒô uczy!"],difficultyId:"very-hard",abilityName:"Moc Ognia",abilityDescription:"+5 obra≈ºe≈Ñ, +1 bonus za seriƒô",attackBonus:5,defense:0,healthBonus:0,healthRegen:0,streakBonus:1,idleTimeBonus:0},{id:"jay",name:"Jay",element:"B≈Çyskawica",color:"#0047AB",emoji:"‚ö°",avatar:"/avatars/jay.svg",encouragements:["Elektrycznie! B≈Çyskawiczna odpowied≈∫!","Szok! Jak szybko!","PiorunujƒÖca robota!","Jeste≈õ jak b≈Çyskawica!"],comforts:["Hej, nawet b≈Çyskawice czasem chybiajƒÖ!","Spr√≥buj jeszcze! Bƒôdzie super!","Nie martw siƒô, dasz radƒô!"],difficultyId:"hard",abilityName:"B≈Çyskawica",abilityDescription:"+3s czasu, +1 bonus za seriƒô",attackBonus:0,defense:0,healthBonus:0,healthRegen:0,streakBonus:1,idleTimeBonus:3e3},{id:"cole",name:"Cole",element:"Ziemia",color:"#2F2F2F",emoji:"üèîÔ∏è",avatar:"/avatars/cole.svg",encouragements:["Solidna odpowied≈∫ jak ska≈Ça!","Mocne! Ziemia siƒô trzƒôsie!","Niewzruszony jak g√≥ra!","Skalna pewno≈õƒá!"],comforts:["BƒÖd≈∫ silny jak g√≥ra, pr√≥buj dalej!","Ziemia jest cierpliwa, Ty te≈º bƒÖd≈∫!","Ka≈ºda g√≥ra zaczyna siƒô od kamyka!"],difficultyId:"medium",abilityName:"Kamienna Zbroja",abilityDescription:"+10 HP, -2 otrzymanych obra≈ºe≈Ñ",attackBonus:0,defense:2,healthBonus:10,healthRegen:0,streakBonus:0,idleTimeBonus:0},{id:"zane",name:"Zane",element:"L√≥d",color:"#87CEEB",emoji:"‚ùÑÔ∏è",avatar:"/avatars/zane.svg",encouragements:["Lodowato precyzyjne!","Ch≈Çodna kalkulacja!","Zimna krew, gorƒÖcy wynik!","Doskona≈Ça logika!"],comforts:["Analiza b≈Çƒôdu pomo≈ºe nastƒôpnym razem.","Spokojnie, oblicz jeszcze raz.","Ka≈ºdy b≈ÇƒÖd to nauka!"],difficultyId:"easy",abilityName:"Lodowa Tarcza",abilityDescription:"+1s czasu, +1 regeneracji HP",attackBonus:0,defense:0,healthBonus:0,healthRegen:1,streakBonus:0,idleTimeBonus:1e3},{id:"lloyd",name:"Lloyd",element:"Energia",color:"#228B22",emoji:"üíö",avatar:"/avatars/lloyd.svg",encouragements:["Zielona moc! ≈öwietnie!","Energia p≈Çynie przez Ciebie!","Mistrzowskie obliczenie!","Prawdziwy Zielony Ninja!"],comforts:["Nawet Zielony Ninja musia≈Ç siƒô uczyƒá!","Energia wraca! Spr√≥buj jeszcze!","Wierzƒô w Ciebie, wojowniku!"],difficultyId:"master",abilityName:"Z≈Çota Moc",abilityDescription:"+3 obra≈ºe≈Ñ, +10 HP, +2 regen, +1 seria",attackBonus:3,defense:0,healthBonus:10,healthRegen:2,streakBonus:1,idleTimeBonus:0},{id:"nya",name:"Nya",element:"Woda",color:"#4169E1",emoji:"üíß",avatar:"/avatars/nya.svg",encouragements:["P≈Çynna perfekcja!","Jak fala - nie do zatrzymania!","Wodna precyzja!","≈öwietny przep≈Çyw my≈õli!"],comforts:["Woda zawsze znajdzie drogƒô, Ty te≈º!","P≈Çy≈Ñ dalej, nie poddawaj siƒô!","Ka≈ºda kropla siƒô liczy!"],difficultyId:"very-easy",abilityName:"Fala Uzdrowienia",abilityDescription:"+2 regeneracji HP, bez limitu czasu!",attackBonus:0,defense:0,healthBonus:0,healthRegen:2,streakBonus:0,idleTimeBonus:0}],I=[{id:"very-easy",name:"Very Easy",namePolish:"Bardzo ≈Çatwy",maxNumber:5,operators:["+","-"],description:"Dodawanie i odejmowanie do 5",disableIdleTimer:!0},{id:"easy",name:"Easy",namePolish:"≈Åatwy",maxNumber:10,operators:["+","-"],description:"Dodawanie i odejmowanie do 10",disableIdleTimer:!1},{id:"medium",name:"Medium",namePolish:"≈öredni",maxNumber:20,operators:["+","-"],description:"Dodawanie i odejmowanie do 20",disableIdleTimer:!1},{id:"hard",name:"Hard",namePolish:"Trudny",maxNumber:35,operators:["+","-"],description:"Dodawanie i odejmowanie do 35",disableIdleTimer:!1},{id:"very-hard",name:"Very Hard",namePolish:"Bardzo trudny",maxNumber:50,operators:["+","-"],description:"Dodawanie i odejmowanie do 50",disableIdleTimer:!1},{id:"custom",name:"Custom",namePolish:"W≈Çasny",maxNumber:10,operators:["+","-"],description:"Dostosuj ustawienia",disableIdleTimer:!1,isCustom:!0}],_e="ninjago-math-game-save",u={PLAYER_MAX_HEALTH:100,ENEMY_BASE_HEALTH:100,ENEMY_HEALTH_INCREMENT:20,PLAYER_ATTACK_DAMAGE:15,ENEMY_ATTACK_DAMAGE:20,IDLE_ATTACK_DAMAGE:10,IDLE_TIMEOUT_MAX_MS:15e3,IDLE_TIMEOUT_MIN_MS:8e3,HEALTH_REGEN_ON_HIT:5,STREAK_BONUS_DAMAGE:3,SKELETON_REPEATS:3},ze=[{id:"skeleton",name:"Szkielet",emoji:"üíÄ",color:"#4a0080",scale:1,isBoss:!1},{id:"skeleton-warrior",name:"Szkielet Wojownik",emoji:"‚öîÔ∏è",color:"#5a1090",scale:1.1,isBoss:!1},{id:"skeleton-archer",name:"Szkielet ≈Åucznik",emoji:"üèπ",color:"#6a2090",scale:1,isBoss:!1},{id:"shadow-scout",name:"Zwiadowca Cienia",emoji:"üë§",color:"#2a2040",scale:1.1,isBoss:!1},{id:"stone-warrior",name:"Kamienny Wojownik",emoji:"üóø",color:"#6b5b45",scale:1.2,isBoss:!0},{id:"serpentine",name:"Serpentyn",emoji:"üêç",color:"#228b22",scale:1.3,isBoss:!0},{id:"nindroid",name:"Nindroid",emoji:"ü§ñ",color:"#404040",scale:1.4,isBoss:!0},{id:"ghost",name:"Duch",emoji:"üëª",color:"#00ff88",scale:1.5,isBoss:!0},{id:"oni",name:"Oni",emoji:"üëπ",color:"#8b0000",scale:1.6,isBoss:!0},{id:"dragon-hunter",name:"≈Åowca Smok√≥w",emoji:"üèπ",color:"#8b4513",scale:1.7,isBoss:!0},{id:"ice-samurai",name:"Lodowy Samuraj",emoji:"‚ùÑÔ∏è",color:"#87ceeb",scale:1.25,isBoss:!0},{id:"shadow-master",name:"Mistrz Cienia",emoji:"üåë",color:"#1a1a2e",scale:1.35,isBoss:!0},{id:"pyro-viper",name:"Ognisty WƒÖ≈º",emoji:"üî•",color:"#ff4500",scale:1.45,isBoss:!0},{id:"overlord",name:"Overlord",emoji:"üòà",color:"#1a0033",scale:2,isBoss:!0}],fe=[{id:"serpentine",name:"Inwazja Serpentyn√≥w",description:"Wƒô≈ºe atakujƒÖ Ninjago!",bossOrder:["serpentine","pyro-viper","stone-warrior","shadow-master","oni","dragon-hunter"]},{id:"tech",name:"Cyberprzejƒôcie",description:"Nindroids przejƒô≈Çy kontrolƒô!",bossOrder:["nindroid","ice-samurai","ghost","shadow-master","stone-warrior","dragon-hunter"]},{id:"shadow",name:"Cienie z Otch≈Çani",description:"Mroczne moce budzƒÖ siƒô...",bossOrder:["ghost","shadow-master","oni","ice-samurai","serpentine","dragon-hunter"]},{id:"classic",name:"Klasyczna Przygoda",description:"Tradycyjna podr√≥≈º ninja",bossOrder:["stone-warrior","serpentine","nindroid","ghost","oni","dragon-hunter"]}];function Ke(){const e=Math.floor(Math.random()*fe.length);return fe[e]}function ce(e){return ze.find(t=>t.id===e)}const Be=ze.filter(e=>!e.isBoss);function k(e,t){if(e<=u.SKELETON_REPEATS+1){const r=Math.floor(Math.random()*Be.length);return Be[r]}t||(t=fe.find(s=>s.id==="classic"));const a=e-u.SKELETON_REPEATS-2;if(a>=t.bossOrder.length)return ce("overlord");const n=t.bossOrder[a];return ce(n)||ce("overlord")}function F(e){const t=k(e),a=u.ENEMY_BASE_HEALTH,n=Math.max(0,e-1)*u.ENEMY_HEALTH_INCREMENT;return Math.floor(a*t.scale+n)}function v(e){return Math.floor(Math.random()*e)+1}function ye(e){return e[Math.floor(Math.random()*e.length)]}function Pe(e){const t=v(Math.max(1,e-1)),a=Math.max(1,e-t),n=v(a);return{operand1:t,operand2:n,operator:"+",correctAnswer:t+n}}function pt(e){const t=v(Math.max(2,e-1))+1,a=v(t-1);return{operand1:t,operand2:a,operator:"-",correctAnswer:t-a}}function gt(e){const t=Math.min(10,Math.floor(Math.sqrt(e))),a=v(Math.max(1,t)),n=v(Math.max(1,t));return{operand1:a,operand2:n,operator:"*",correctAnswer:a*n}}function wt(e){const t=Math.min(10,Math.floor(Math.sqrt(e))),a=v(Math.max(1,t)),n=v(Math.max(1,t));return{operand1:a*n,operand2:a,operator:"/",correctAnswer:n}}function he(e){switch(ye(e.operators)){case"+":return Pe(e.maxNumber);case"-":return pt(e.maxNumber);case"*":return gt(e.maxNumber);case"/":return wt(e.maxNumber);default:return Pe(e.maxNumber)}}function bt(e,t){return e?e.operand1===t.operand1&&e.operand2===t.operand2&&e.operator===t.operator:!1}function kt(e,t){let a=he(e),n=0;const i=10;for(;bt(t,a)&&n<i;)a=he(e),n++;return a}function vt(e,t){return e.correctAnswer===t}function Q(e){let t=e.operator;return e.operator==="*"&&(t="√ó"),e.operator==="/"&&(t="√∑"),`${e.operand1} ${t} ${e.operand2} = ?`}function X(e){try{localStorage.setItem(_e,JSON.stringify(e))}catch{console.warn("Nie mo≈ºna zapisaƒá danych gry")}}function Ve(){try{const e=localStorage.getItem(_e);if(e)return JSON.parse(e)}catch{console.warn("Nie mo≈ºna wczytaƒá danych gry")}return null}function We(e){return q.find(t=>t.id===e)||q[0]}function Ye(e){return I.find(t=>t.id===e)||I[0]}function xt(e){const t=I.find(a=>a.id==="custom");if(!t)throw new Error("Custom difficulty not found");return t.maxNumber=e.maxNumber,t.operators=e.operators,t.disableIdleTimer=e.disableIdleTimer,t.description=zt(e),t}function zt(e){const t=e.operators.map(n=>{switch(n){case"+":return"dodawanie";case"-":return"odejmowanie";case"*":return"mno≈ºenie";case"/":return"dzielenie";default:return n}}).join(", "),a=e.disableIdleTimer?", bez timera":"";return`${t} do ${e.maxNumber}${a}`}function Tt(){const e=Ve();return e?.customDifficulty?e.customDifficulty:{maxNumber:10,operators:["+","-"],disableIdleTimer:!1}}function Te(e){return e==="custom"?We("lloyd"):q.find(t=>t.difficultyId===e)||q[0]}function je(){const e=Ve(),t=e?Ye(e.selectedDifficultyId):I[0],a=Te(t.id),n=e?.highScore||0,i=u.PLAYER_MAX_HEALTH+a.healthBonus,r=Ke();return{currentNinja:a,score:0,highScore:n,streak:0,currentProblem:null,difficulty:t,totalProblems:0,correctAnswers:0,isGameActive:!1,playerHealth:i,maxPlayerHealth:i,enemyHealth:F(1),maxEnemyHealth:F(1),isGameOver:!1,lastAnswerTime:Date.now(),enemyLevel:1,enemiesDefeated:0,storyPath:r}}function Ee(e){const t=F(1),a=u.PLAYER_MAX_HEALTH+e.currentNinja.healthBonus,n=Ke();return{...e,score:0,streak:0,currentProblem:he(e.difficulty),totalProblems:0,correctAnswers:0,isGameActive:!0,playerHealth:a,maxPlayerHealth:a,enemyHealth:t,maxEnemyHealth:t,isGameOver:!1,lastAnswerTime:Date.now(),enemyLevel:1,enemiesDefeated:0,storyPath:n}}function jt(e,t){if(!e.currentProblem||e.isGameOver)return{state:e,isCorrect:!1,message:"",playerAttacked:!1,enemyAttacked:!1,enemyDefeated:!1,playerDefeated:!1,damageDealt:0,damageTaken:0,newEnemyType:null};const a=vt(e.currentProblem,t),n=e.currentNinja;let i=e.score,r=e.streak,s=e.highScore,y=e.playerHealth,h=e.enemyHealth,E=e.maxEnemyHealth,d=e.enemyLevel,g=e.enemiesDefeated,A,C=0,re=0,se=!1,K=!1;if(a){const Ne=Math.min(r,5),ut=10+Ne*2;i+=ut,r+=1,A=ye(n.encouragements),i>s&&(s=i);const ft=u.STREAK_BONUS_DAMAGE+n.streakBonus;C=u.PLAYER_ATTACK_DAMAGE+n.attackBonus+Ne*ft,h=Math.max(0,h-C);const yt=u.HEALTH_REGEN_ON_HIT+n.healthRegen;if(y=Math.min(e.maxPlayerHealth,y+yt),h<=0){se=!0,g++,d++;const Ce=F(d);h=Ce,E=Ce;const ht=k(e.enemyLevel,e.storyPath).isBoss?100:50;i+=ht,i>s&&(s=i)}}else r=0,A=ye(n.comforts),re=Math.max(1,u.ENEMY_ATTACK_DAMAGE-n.defense),y=Math.max(0,y-re),y<=0&&(K=!0);const mt={...e,score:i,highScore:s,streak:r,currentProblem:K?null:kt(e.difficulty,e.currentProblem),totalProblems:e.totalProblems+1,correctAnswers:e.correctAnswers+(a?1:0),playerHealth:y,enemyHealth:h,maxEnemyHealth:E,isGameOver:K,lastAnswerTime:Date.now(),enemyLevel:d,enemiesDefeated:g};return X({highScore:s,selectedNinjaId:e.currentNinja.id,selectedDifficultyId:e.difficulty.id}),{state:mt,isCorrect:a,message:A,playerAttacked:a,enemyAttacked:!a,enemyDefeated:se,playerDefeated:K,damageDealt:C,damageTaken:re,newEnemyType:se&&k(e.enemyLevel,e.storyPath).id!=="overlord"?k(d,e.storyPath):null}}function Et(e){if(!e.isGameActive||e.isGameOver)return{state:e,attacked:!1,damage:0,playerDefeated:!1};const t=u.IDLE_ATTACK_DAMAGE,a=Math.max(0,e.playerHealth-t),n=a<=0;return{state:{...e,playerHealth:a,isGameOver:n,lastAnswerTime:Date.now()},attacked:!0,damage:t,playerDefeated:n}}function qe(e,t=0){const a=ze.length+u.SKELETON_REPEATS-1,n=Math.min(e-1,a-1)/(a-1),i=u.IDLE_TIMEOUT_MAX_MS-u.IDLE_TIMEOUT_MIN_MS;return Math.floor(u.IDLE_TIMEOUT_MAX_MS-n*i)+t}function At(e){if(!e.isGameActive||e.isGameOver||e.difficulty.disableIdleTimer)return!1;const t=Date.now()-e.lastAnswerTime,a=qe(e.enemyLevel,e.currentNinja.idleTimeBonus);return t>=a}function Fe(e,t){const a=We(t);return X({highScore:e.highScore,selectedNinjaId:a.id,selectedDifficultyId:e.difficulty.id}),{...e,currentNinja:a}}function ee(e,t){const a=Ye(t),n=Te(t),i=u.PLAYER_MAX_HEALTH+n.healthBonus;return X({highScore:e.highScore,selectedNinjaId:n.id,selectedDifficultyId:a.id}),{...e,difficulty:a,currentNinja:n,maxPlayerHealth:i,playerHealth:i}}let le=null,M=!1;const De=localStorage.getItem("ninjago-muted");De!==null&&(M=De==="true");function St(){return le||(le=new(window.AudioContext||window.webkitAudioContext)),le}function Lt(e){const t=e.currentTime;[523.25,659.25,783.99].forEach((n,i)=>{const r=e.createOscillator(),s=e.createGain();r.type="sine",r.frequency.value=n,s.gain.setValueAtTime(0,t+i*.05),s.gain.linearRampToValueAtTime(.15,t+i*.05+.05),s.gain.exponentialRampToValueAtTime(.01,t+.4),r.connect(s),s.connect(e.destination),r.start(t+i*.05),r.stop(t+.5)})}function Mt(e){const t=e.currentTime,a=e.createOscillator(),n=e.createGain();a.type="square",a.frequency.setValueAtTime(200,t),a.frequency.linearRampToValueAtTime(150,t+.2),n.gain.setValueAtTime(.1,t),n.gain.exponentialRampToValueAtTime(.01,t+.25),a.connect(n),n.connect(e.destination),a.start(t),a.stop(t+.3)}function Nt(e){const t=e.currentTime,a=e.createOscillator(),n=e.createGain();a.type="sawtooth",a.frequency.setValueAtTime(800,t),a.frequency.exponentialRampToValueAtTime(200,t+.15),n.gain.setValueAtTime(.12,t),n.gain.exponentialRampToValueAtTime(.01,t+.15),a.connect(n),n.connect(e.destination),a.start(t),a.stop(t+.2)}function Ct(e){const t=e.currentTime,a=e.sampleRate*.1,n=e.createBuffer(1,a,e.sampleRate),i=n.getChannelData(0);for(let h=0;h<a;h++)i[h]=(Math.random()*2-1)*Math.exp(-h/(a*.1));const r=e.createBufferSource();r.buffer=n;const s=e.createBiquadFilter();s.type="lowpass",s.frequency.value=500;const y=e.createGain();y.gain.setValueAtTime(.2,t),y.gain.exponentialRampToValueAtTime(.01,t+.1),r.connect(s),s.connect(y),y.connect(e.destination),r.start(t)}function Bt(e){const t=e.currentTime;[{freq:523.25,start:0,duration:.15},{freq:659.25,start:.1,duration:.15},{freq:783.99,start:.2,duration:.15},{freq:1046.5,start:.3,duration:.4}].forEach(n=>{const i=e.createOscillator(),r=e.createGain();i.type="triangle",i.frequency.value=n.freq,r.gain.setValueAtTime(0,t+n.start),r.gain.linearRampToValueAtTime(.15,t+n.start+.02),r.gain.exponentialRampToValueAtTime(.01,t+n.start+n.duration),i.connect(r),r.connect(e.destination),i.start(t+n.start),i.stop(t+n.start+n.duration+.1)})}function Pt(e){const t=e.currentTime;[{freq:392,start:0,duration:.3},{freq:349.23,start:.25,duration:.3},{freq:293.66,start:.5,duration:.5}].forEach(n=>{const i=e.createOscillator(),r=e.createGain();i.type="sine",i.frequency.value=n.freq,r.gain.setValueAtTime(0,t+n.start),r.gain.linearRampToValueAtTime(.12,t+n.start+.05),r.gain.exponentialRampToValueAtTime(.01,t+n.start+n.duration),i.connect(r),r.connect(e.destination),i.start(t+n.start),i.stop(t+n.start+n.duration+.1)})}function Dt(e){const t=e.currentTime,a=e.createOscillator(),n=e.createGain();a.type="sine",a.frequency.value=600,n.gain.setValueAtTime(.08,t),n.gain.exponentialRampToValueAtTime(.01,t+.05),a.connect(n),n.connect(e.destination),a.start(t),a.stop(t+.06)}function Ot(e){const t=e.currentTime;[0,.1].forEach((a,n)=>{const i=e.createOscillator(),r=e.createGain();i.type="square",i.frequency.value=n===0?440:880,r.gain.setValueAtTime(.1,t+a),r.gain.exponentialRampToValueAtTime(.01,t+a+.1),i.connect(r),r.connect(e.destination),i.start(t+a),i.stop(t+a+.15)})}function l(e){if(!M)try{const t=St();switch(t.state==="suspended"&&t.resume(),e){case"correct":Lt(t);break;case"wrong":Mt(t);break;case"attack":Nt(t);break;case"hit":Ct(t);break;case"victory":Bt(t);break;case"gameOver":Pt(t);break;case"click":Dt(t);break;case"start":Ot(t);break}}catch(t){console.warn("Audio error:",t)}}function It(e){M=e,localStorage.setItem("ninjago-muted",String(e))}function pe(){return M}function Ht(){return It(!M),M}let b=!0,Ue=null;const Oe=localStorage.getItem("ninjago-speech");Oe!==null&&(b=Oe==="true");function $t(){if(!("speechSynthesis"in window))return;const e=()=>{const t=speechSynthesis.getVoices();Ue=t.find(a=>a.lang.startsWith("pl"))||t.find(a=>a.lang.startsWith("en"))||t[0]||null};speechSynthesis.getVoices().length>0?e():speechSynthesis.onvoiceschanged=e}function te(e,t){if(!b||!("speechSynthesis"in window))return;const a=e.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[‚úì‚úó‚ö†Ô∏è]/gu,"").trim();if(!a)return;t?.priority&&speechSynthesis.cancel();const n=new SpeechSynthesisUtterance(a);n.voice=Ue,n.rate=t?.rate??1.1,n.pitch=t?.pitch??1,n.volume=.8,speechSynthesis.speak(n)}function Rt(e){if(e<2)return;const t=["Nie≈∫le!","O ho ho!","Lecimy!","Jest kontakt!","No proszƒô!","Dzia≈Ça!","Dobrze idzie!","≈Åadnie!"],a=["Trzy! Kombo!","Tr√≥jka! Tak!","Heja!","Trzy z rzƒôdu!","Rozpƒôdzamy siƒô!","Ooo tak!","No i git!","Trzy! Brawo!"],n=["Cztery! Wow!","O rany!","Ale jazda!","Czw√≥reczka!","Petarda!","No no no!","Sztos!","Grubo!"],i=["Super piƒÖtka!","Piƒôƒá! Moc!","Bum bum bum!","PiƒÖteczka!","High five!","Piƒôƒá gwiazdek!","Mega!","Bomba!"],r=["Sze≈õƒá! Sza≈Ç!","Nie do zatrzymania!","Rakieta!","Sz√≥stka!","Hura!","Pƒôdzi ninja!","Turbo mode!","Kosmicznie!"],s=["Epicki! Siedem!","Mistrz!","Magia!","Siedem! Wow!","Czary mary!","Geniusz!","Szczƒô≈õliwa si√≥demka!","Ninja power!"],y=["Osiem! Szok!","Fenomen!","Kosmos!","√ìsemka!","Galaktyka!","Ekstremalne!","Niewiarygodne!","Osza≈ÇamiajƒÖce!"],h=["Dziewiƒôƒá! Prawie!","Jeszcze jeden!","Dalej dalej!","Ostatnia prosta!","Do dziesiƒÖtki!","Jeszcze raz!","Tak blisko!","Finisz!"],E=["Legendarny!","Absolutny mistrz!","Nie do pokonania!","Mega ninja!","Matematyczny b√≥g!","Perfekcja!","Wszechmocny!","Kr√≥l matmy!","Totalny sza≈Ç!","Superbohater!","Niezwyciƒô≈ºony!","Mistrz wszech≈õwiata!","Z≈Çota seria!","Diamentowe combo!"];let d,g=1,A=1.2;e>=10?(d=E,g=1.3,A=1):e===9?(d=h,g=1.25):e===8?(d=y,g=1.2):e===7?(d=s,g=1.15):e===6?(d=r,g=1.1):e===5?(d=i,g=1.05):e===4?d=n:e===3?d=a:d=t;const C=d[Math.floor(Math.random()*d.length)];te(C,{pitch:g,rate:A,priority:!0})}function Gt(){return b=!b,localStorage.setItem("ninjago-speech",String(b)),b?te("G≈Ços w≈ÇƒÖczony",{priority:!0}):speechSynthesis.cancel(),b}function Ie(){return b}$t();function O(e){if(!navigator.vibrate)return;const t={tap:10,hit:50,combo:[30,20,30,20,50],damage:[100,30,100]};navigator.vibrate(t[e])}const He={kai:{particles:["üî•","üí•","‚ú®"],colors:["#ff4400","#ff6600","#ffaa00"],glowColor:"#ff4400"},zane:{particles:["‚ùÑÔ∏è","üíé","‚ú®"],colors:["#87ceeb","#00ffff","#ffffff"],glowColor:"#00ffff"},jay:{particles:["‚ö°","üí´","‚ú®"],colors:["#ffff00","#0088ff","#ffffff"],glowColor:"#ffff00"},cole:{particles:["ü™®","üí™","‚ú®"],colors:["#8b4513","#5a3510","#a0522d"],glowColor:"#8b4513"},nya:{particles:["üíß","üåä","‚ú®"],colors:["#4169e1","#1e90ff","#00bfff"],glowColor:"#4169e1"},lloyd:{particles:["‚ú®","üíö","‚≠ê"],colors:["#228b22","#ffd700","#32cd32"],glowColor:"#228b22"}};function Ze(e,t,a){const n=He[e]||He.lloyd,i=document.createElement("div");i.className=`elemental-effect ${e}`,i.style.position="fixed",i.style.left=`${t}px`,i.style.top=`${a}px`,i.style.pointerEvents="none",i.style.zIndex="1000";for(let r=0;r<12;r++){const s=document.createElement("span");s.className="elemental-particle",s.textContent=n.particles[Math.floor(Math.random()*n.particles.length)],s.style.setProperty("--i",String(r)),s.style.setProperty("--color",n.colors[Math.floor(Math.random()*n.colors.length)]),i.appendChild(s)}document.body.appendChild(i),setTimeout(()=>i.remove(),1e3)}let o=je(),V=null,W=null,B=null;const _t={emoji:"üèØ",text:"Ninjago jest w niebezpiecze≈Ñstwie! Armia szkielet√≥w zaatakowa≈Ça miasto. Tylko TY mo≈ºesz ich powstrzymaƒá... u≈ºywajƒÖc mocy MATEMATYKI! üßÆ‚ö°"},$e={skeleton:{gradient:"linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 30%, #1a0a2e 70%, #0d0518 100%)",particles:"üíÄ",ambientColor:"#4a0080",floatingElements:["ü¶¥","üíÄ","‚öîÔ∏è","üïØÔ∏è"]},"skeleton-warrior":{gradient:"linear-gradient(180deg, #1f0a3a 0%, #3d1b5e 30%, #2a1045 70%, #0d0518 100%)",particles:"‚öîÔ∏è",ambientColor:"#5a1090",floatingElements:["‚öîÔ∏è","üó°Ô∏è","üíÄ","üõ°Ô∏è"]},"skeleton-archer":{gradient:"linear-gradient(180deg, #250a40 0%, #451b6e 30%, #351250 70%, #150820 100%)",particles:"üèπ",ambientColor:"#6a2090",floatingElements:["üèπ","üíÄ","üéØ","ü¶¥"]},"shadow-scout":{gradient:"linear-gradient(180deg, #0a0a15 0%, #1a1830 30%, #101020 70%, #050508 100%)",particles:"üë§",ambientColor:"#2a2040",floatingElements:["üë§","üåë","üó°Ô∏è","üëÅÔ∏è"]},"stone-warrior":{gradient:"linear-gradient(180deg, #2a2218 0%, #4a3c2e 30%, #3b3025 70%, #1a1510 100%)",particles:"ü™®",ambientColor:"#6b5b45",floatingElements:["üóø","ü™®","‚õ∞Ô∏è","üèõÔ∏è"]},serpentine:{gradient:"linear-gradient(180deg, #0a2a1a 0%, #1b4e2e 30%, #0d3318 70%, #051a0d 100%)",particles:"üêç",ambientColor:"#228b22",floatingElements:["üêç","üåø","üçÉ","‚ò†Ô∏è"]},nindroid:{gradient:"linear-gradient(180deg, #0a0a1a 0%, #1a1a3e 30%, #0d0d2a 70%, #050510 100%)",particles:"‚ö°",ambientColor:"#4040ff",floatingElements:["ü§ñ","‚ö°","üí†","üî©"]},ghost:{gradient:"linear-gradient(180deg, #0a2a2a 0%, #1b4e4e 30%, #0d3333 70%, #051a1a 100%)",particles:"üëª",ambientColor:"#00ff88",floatingElements:["üëª","üå´Ô∏è","üíÄ","üïØÔ∏è"]},oni:{gradient:"linear-gradient(180deg, #2a0a0a 0%, #4e1b1b 30%, #330d0d 70%, #1a0505 100%)",particles:"üî•",ambientColor:"#ff4444",floatingElements:["üëπ","üî•","‚õìÔ∏è","üíÄ"]},"dragon-hunter":{gradient:"linear-gradient(180deg, #1a1510 0%, #3e2b1b 30%, #2a1d12 70%, #100a05 100%)",particles:"üèπ",ambientColor:"#8b4513",floatingElements:["üèπ","üêâ","‚öîÔ∏è","üéØ"]},"ice-samurai":{gradient:"linear-gradient(180deg, #0a1a2a 0%, #1b3e5e 30%, #0d2a3a 70%, #051018 100%)",particles:"‚ùÑÔ∏è",ambientColor:"#87ceeb",floatingElements:["‚ùÑÔ∏è","üßä","‚öîÔ∏è","üå®Ô∏è"]},"shadow-master":{gradient:"linear-gradient(180deg, #050510 0%, #0a0a1a 30%, #080815 70%, #020205 100%)",particles:"üåë",ambientColor:"#1a1a2e",floatingElements:["üåë","üë§","üï≥Ô∏è","‚ú®"]},"pyro-viper":{gradient:"linear-gradient(180deg, #2a0a00 0%, #4e1b08 30%, #331005 70%, #1a0800 100%)",particles:"üî•",ambientColor:"#ff4500",floatingElements:["üî•","üêç","üåã","üí•"]},overlord:{gradient:"linear-gradient(180deg, #0d0015 0%, #1a0033 30%, #0d001a 70%, #050008 100%)",particles:"üòà",ambientColor:"#9900ff",floatingElements:["üòà","‚ö°","üíÄ","üåë"]}},Kt={"stone-warrior":{emoji:"üóø",texts:["UWAGA! Kamienny Wojownik siƒô zbli≈ºa! Ten staro≈ºytny stra≈ºnik jest niezniszczalny... prawie. Twoja inteligencja jest twojƒÖ broniƒÖ!","Ziemia dr≈ºy! Kamienny Wojownik budzi siƒô z tysiƒÖcletniego snu! Tylko matematyka mo≈ºe przebiƒá jego kamiennƒÖ zbrojƒô!","KRACH! Kamienny kolos blokuje ci drogƒô! Jego piƒô≈õci sƒÖ ciƒô≈ºsze ni≈º ska≈Çy, ale tw√≥j umys≈Ç jest szybszy!"]},serpentine:{emoji:"üêç",texts:["Sssserpentyn wy≈Çania siƒô z cieni! Ten podstƒôpny wƒÖ≈º hypnotyzuje swoje ofiary. Nie daj siƒô zahipnotyzowaƒá - skup siƒô na liczbach!","Syk rozlega siƒô w ciemno≈õciach... Serpentyn czai siƒô! Jego jad jest ≈õmiertelny, ale twoja wiedza jest silniejsza!","UWAGA NA OGON! Serpentyn atakuje znienacka! Poka≈º mu, ≈ºe ninja nigdy nie daje siƒô zaskoczyƒá!"]},nindroid:{emoji:"ü§ñ",texts:["ALERT SYSTEMU! Nindroid aktywowany. Ta maszyna wojenna oblicza 1000 dzia≈Ça≈Ñ na sekundƒô. Czy nadƒÖ≈ºysz?","BIP BIP! Nindroid skanuje cel... WYKRYTO NINJA! Czy tw√≥j m√≥zg jest szybszy ni≈º jego procesory?","SYSTEM BOJOWY ONLINE! Nindroid uruchamia protok√≥≈Ç eliminacji. Czas pokazaƒá, ≈ºe cz≈Çowiek > maszyna!"]},ghost:{emoji:"üëª",texts:["Temperatura spada... Duch z Kr√≥lestwa Umar≈Çych nawiedza arenƒô! Tylko czysty umys≈Ç mo≈ºe go pokonaƒá!","Buuuu! Zjawa przenika przez ≈õciany! Ten duch jest nieuchwytny... ale liczby go zraniƒÖ!","Lodowaty wiatr... Duch szuka ofiary! Nie b√≥j siƒô - skup siƒô na zadaniach i przepƒôd≈∫ go!"]},oni:{emoji:"üëπ",texts:["DR≈ªYJ ≈öMIERTELNIKU! Oni - demon z innego wymiaru - ≈ºƒÖda twojej duszy! Poka≈º mu moc ninja!","HUAHAHAHA! Oni przybywa z Kr√≥lestwa Ciemno≈õci! Jego gniew jest straszliwy, ale ty jeste≈õ ninja!","Powietrze gƒôstnieje od z≈Ça... Oni nadchodzi! Tylko prawdziwy wojownik mo≈ºe stawiƒá mu czo≈Ça!"]},"dragon-hunter":{emoji:"üèπ",texts:["≈Åowca Smok√≥w namierzy≈Ç nowy cel... CIEBIE! Ten bezwzglƒôdny my≈õliwy nigdy nie chybia. BƒÖd≈∫ szybszy!","GOTUJ SIƒò! ≈Åowca Smok√≥w napina ≈Çuk! Ka≈ºda sekunda zw≈Çoki to strza≈Ça lecƒÖca w twojƒÖ stronƒô!","Oczy my≈õliwego ≈õwiecƒÖ w mroku... ≈Åowca Smok√≥w ciƒô obserwuje! Poka≈º mu, kto tu jest prawdziwym ≈ÇowcƒÖ!"]},"ice-samurai":{emoji:"‚ùÑÔ∏è",texts:["Mr√≥z pokrywa arenƒô! Lodowy Samuraj przybywa z zamarzniƒôtych pustkowi! Jego miecz jest zimny jak ≈õmierƒá!","KRYSZTA≈ÅY LODU! Lodowy Samuraj zamra≈ºa wszystko na swojej drodze! Rozgrzej umys≈Ç i walcz!","Temperatura spada gwa≈Çtownie... Lodowy wojownik nadchodzi! Twoja gorƒÖca g≈Çowa jest twojƒÖ broniƒÖ!"]},"shadow-master":{emoji:"üåë",texts:["Cienie gƒôstniejƒÖ... Mistrz Cienia materializuje siƒô z mroku! W ciemno≈õci jest niewidzialny!","ZNIKAM I POJAWIAM SIƒò! Mistrz Cienia to iluzjonista z≈Ça! Skup wzrok na liczbach, nie na cieniach!","≈öwiat≈Ço ga≈õnie... Mistrz Cienia przejmuje kontrolƒô! Tylko b≈Çyskotliwy umys≈Ç roz≈õwietli tƒô ciemno≈õƒá!"]},"pyro-viper":{emoji:"üî•",texts:["P≈ÅOMIENIE! Ognisty WƒÖ≈º zieje ≈ºarem! Ten serpentyn jest zrodzony z lawy wulkanu!","GorƒÖco robi siƒô niezno≈õnie! Pyro Viper atakuje ogniem! Zachowaj zimnƒÖ krew!","SSSYK P≈ÅOMIENI! Ognisty WƒÖ≈º pali wszystko na swojej drodze! Poka≈º mu, ≈ºe tw√≥j umys≈Ç nie sp≈Çonie!"]},overlord:{emoji:"üòà",texts:[`‚ö†Ô∏è FINA≈ÅOWA BITWA ‚ö†Ô∏è

OVERLORD - W≈Çadca Ciemno≈õci - powsta≈Ç! To jest TO. Ostateczne starcie dobra ze z≈Çem. Ca≈Ça nadzieja Ninjago spoczywa na TOBIE! üåü`,`‚ö†Ô∏è OSTATECZNA KONFRONTACJA ‚ö†Ô∏è

OVERLORD powr√≥ci≈Ç potƒô≈ºniejszy ni≈º kiedykolwiek! Los ca≈Çego Ninjago zale≈ºy od twoich oblicze≈Ñ! BƒÖd≈∫ najlepszƒÖ wersjƒÖ siebie! üåü`,`‚ö†Ô∏è DECYDUJƒÑCA WALKA ‚ö†Ô∏è

OVERLORD - Prastara Ciemno≈õƒá - budzi siƒô! To moment, na kt√≥ry trenowa≈Çe≈õ ca≈Çe ≈ºycie! NIE ZAWIED≈π NINJAGO! üåü`]}};function Vt(e){const t=Kt[e];if(!t)return null;const a=Math.floor(Math.random()*t.texts.length);return{emoji:t.emoji,text:t.texts[a]}}const c=e=>{const t=document.querySelector(e);if(!t)throw new Error(`Element not found: ${e}`);return t},Re=c("#start-screen"),z=c("#game-screen"),ge=c("#gameover-screen"),Je=c("#difficulty-buttons"),Wt=c("#high-score-value"),Yt=c("#start-btn"),we=c("#mute-btn"),be=c("#speech-btn"),ae=c("#current-score"),ne=c("#current-enemies"),qt=c("#current-damage"),Ft=c("#back-btn"),p=c("#ninja-avatar"),f=c("#enemy-avatar"),Ge=c("#enemy-name"),w=c("#problem-display"),m=c("#answer-input"),L=c("#answer-display"),H=c("#feedback"),T=c("#ninja-message"),Ut=c(".numpad"),Zt=c("#backspace-btn"),Jt=c("#attack-btn"),P=c("#player-health-fill"),de=c("#player-health-text"),D=c("#enemy-health-fill"),me=c("#enemy-health-text"),$=c("#battle-effect"),Qe=c("#player-damage-popup"),Xe=c("#enemy-damage-popup"),ue=c("#idle-timer-fill"),Qt=c("#final-score"),Xt=c("#final-correct"),ea=c("#final-enemies"),ta=c("#restart-btn"),aa=c("#menu-btn"),ke=c("#victory-screen"),na=c("#victory-score"),ia=c("#victory-correct"),oa=c("#victory-enemies"),ra=c("#victory-restart-btn"),sa=c("#victory-menu-btn"),U=c("#custom-modal"),Z=c("#custom-max-number"),et=c("#custom-max-number-value"),ve=c("#op-add"),tt=c("#op-sub"),at=c("#op-mul"),nt=c("#op-div"),it=c("#custom-no-timer"),ca=c("#custom-save-btn"),la=c("#custom-cancel-btn");function Ae(e,t){N();const a=document.createElement("div");a.className="story-overlay",a.innerHTML=`
    <div class="story-emoji">${e.emoji}</div>
    <div class="story-text">${e.text}</div>
    <div class="story-skip">Dotknij aby kontynuowaƒá...</div>
  `,document.body.appendChild(a);const n=()=>{a.classList.add("fade-out"),setTimeout(()=>{a.remove(),o.isGameActive&&!o.isGameOver&&(o.lastAnswerTime=Date.now(),ct()),t&&t()},500)};a.addEventListener("click",n),a.addEventListener("touchstart",n)}function ot(){z.classList.add("screen-shake"),setTimeout(()=>z.classList.remove("screen-shake"),500)}function J(){const e=document.createElement("div");e.className="lightning-effect",document.body.appendChild(e),setTimeout(()=>e.remove(),150)}let S=[];function rt(e){const t=$e[e]||$e.skeleton;S.forEach(r=>r.remove()),S=[],document.body.style.background=t.gradient,document.body.style.transition="background 1.5s ease-in-out",document.documentElement.style.setProperty("--enemy-ambient-color",t.ambientColor);const a=document.createElement("div");a.className="floating-elements-container";for(let r=0;r<15;r++){const s=document.createElement("div");s.className="floating-element",s.textContent=t.floatingElements[Math.floor(Math.random()*t.floatingElements.length)],s.style.left=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*10}s`,s.style.animationDuration=`${15+Math.random()*20}s`,s.style.fontSize=`${1.5+Math.random()*2}rem`,s.style.opacity=`${.15+Math.random()*.25}`,a.appendChild(s)}document.body.appendChild(a),S.push(a);const n=document.createElement("div");n.className="ambient-particles";for(let r=0;r<30;r++){const s=document.createElement("div");s.className="ambient-particle",s.textContent=t.particles,s.style.left=`${Math.random()*100}%`,s.style.top=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*5}s`,s.style.animationDuration=`${3+Math.random()*4}s`,n.appendChild(s)}document.body.appendChild(n),S.push(n);let i=document.querySelector(".vignette-overlay");i||(i=document.createElement("div"),i.className="vignette-overlay",document.body.appendChild(i)),i.style.boxShadow=`inset 0 0 150px 50px ${t.ambientColor}40`}function da(e,t,a,n=12){const i=document.createElement("div");i.className="particle-container",i.style.left=`${e}px`,i.style.top=`${t}px`;for(let r=0;r<n;r++){const s=document.createElement("div");s.className="particle",s.style.backgroundColor=a;const y=r/n*Math.PI*2,h=50+Math.random()*100,E=Math.cos(y)*h,d=Math.sin(y)*h;s.style.setProperty("--tx",`${E}px`),s.style.setProperty("--ty",`${d}px`),i.appendChild(s)}document.body.appendChild(i),setTimeout(()=>i.remove(),1e3)}function ma(e,t){if(e<2)return;const a=document.createElement("div");a.className="combo-display";const n=Math.min(e,10);a.style.setProperty("--combo-scale",String(1+n*.1)),a.style.setProperty("--combo-glow",`${10+n*5}px`);let i="",r="";if(e>=10){r="legendary",i="LEGENDARY!",J();const s=document.body.getBoundingClientRect();Ze(t,s.width/2,s.height/2)}else e>=7?(r="epic",i="EPIC!"):e>=5?(r="super",i="SUPER!"):e>=3?i="COMBO!":i="";r&&a.classList.add(r),a.innerHTML=`
    <span class="combo-number">${e}x</span>
    <span class="combo-label">${i}</span>
  `,document.body.appendChild(a),Rt(e),e>=7&&(document.body.classList.add("combo-border-pulse"),setTimeout(()=>document.body.classList.remove("combo-border-pulse"),1e3)),setTimeout(()=>a.remove(),1e3)}function ua(){const e=document.createElement("div");e.className="ultimate-attack",document.body.appendChild(e),setTimeout(()=>e.remove(),800)}function fa(e="MISTRZ"){const t=document.createElement("div");t.className="level-up-effect",t.innerHTML=`‚öîÔ∏è ${e} POKONANY! ‚öîÔ∏è`,document.body.appendChild(t),setTimeout(()=>t.remove(),1500)}function ya(e){const t=Vt(e.id);t?Ae(t,()=>{J(),ot(),f.classList.add("boss-entrance"),setTimeout(()=>{f.classList.remove("boss-entrance")},1500)}):(f.classList.add("enemy-spawn"),setTimeout(()=>f.classList.remove("enemy-spawn"),600))}function ha(){!o.currentProblem||o.isGameOver||(m.value=String(o.currentProblem.correctAnswer),_(),Me())}function ie(e,t=120){return`
    <svg viewBox="0 0 100 100" width="${t}" height="${t}" class="ninja-svg">
      <!-- T≈Ço z kolorem ≈ºywio≈Çu -->
      <circle cx="50" cy="50" r="48" fill="${e.color}" opacity="0.2"/>
      
      <!-- Cia≈Ço ninja -->
      <ellipse cx="50" cy="70" rx="25" ry="20" fill="${e.color}"/>
      
      <!-- G≈Çowa -->
      <circle cx="50" cy="35" r="22" fill="${e.color}"/>
      
      <!-- Maska ninja (ods≈Çoniƒôte oczy) -->
      <rect x="28" y="28" width="44" height="18" fill="#1a1a1a" rx="4"/>
      
      <!-- Oczy -->
      <ellipse cx="40" cy="35" rx="5" ry="4" fill="white"/>
      <ellipse cx="60" cy="35" rx="5" ry="4" fill="white"/>
      <circle cx="41" cy="35" r="2.5" fill="#222"/>
      <circle cx="61" cy="35" r="2.5" fill="#222"/>
      
      <!-- Blaski w oczach -->
      <circle cx="42" cy="34" r="1" fill="white"/>
      <circle cx="62" cy="34" r="1" fill="white"/>
      
      <!-- Wƒôze≈Ç maski -->
      <circle cx="78" cy="35" r="5" fill="#1a1a1a"/>
      <path d="M 78 40 Q 85 45 82 55" stroke="#1a1a1a" stroke-width="3" fill="none"/>
      <path d="M 78 40 Q 90 42 88 52" stroke="#1a1a1a" stroke-width="3" fill="none"/>
      
      <!-- Symbol ≈ºywio≈Çu -->
      <text x="50" y="85" text-anchor="middle" font-size="20">${e.emoji}</text>
    </svg>
  `}function R(e,t=120){const a=Math.floor(t*e.scale),n=e.isBoss?"#ff0000":"#ff4444",i=e.isBoss?"0.4":"0.2";let r="";switch(e.id){case"skeleton":case"skeleton-warrior":r=`
        <!-- Cia≈Ço szkieleta -->
        <ellipse cx="50" cy="72" rx="22" ry="18" fill="#2d2d2d"/>
        <rect x="38" y="60" width="24" height="3" fill="#d4d4d4" rx="1"/>
        <rect x="40" y="65" width="20" height="3" fill="#d4d4d4" rx="1"/>
        <rect x="42" y="70" width="16" height="3" fill="#d4d4d4" rx="1"/>
        <!-- Czaszka -->
        <circle cx="50" cy="32" r="22" fill="#e8e8e8"/>
        <ellipse cx="40" cy="30" rx="7" ry="8" fill="#1a1a1a"/>
        <ellipse cx="60" cy="30" rx="7" ry="8" fill="#1a1a1a"/>
        <circle cx="40" cy="30" r="3" fill="${n}"/>
        <circle cx="60" cy="30" r="3" fill="${n}"/>
        <path d="M 50 35 L 47 42 L 53 42 Z" fill="#1a1a1a"/>
        <rect x="42" y="44" width="4" height="6" fill="#e8e8e8" rx="1"/>
        <rect x="48" y="44" width="4" height="6" fill="#e8e8e8" rx="1"/>
        <rect x="54" y="44" width="4" height="6" fill="#e8e8e8" rx="1"/>
        ${e.id==="skeleton-warrior"?'<rect x="75" y="20" width="4" height="40" fill="#808080"/><rect x="72" y="55" width="10" height="4" fill="#8B4513"/>':""}
      `;break;case"stone-warrior":r=`
        <!-- Kamienny wojownik -->
        <ellipse cx="50" cy="70" rx="28" ry="22" fill="#5a534a"/>
        <rect x="35" y="55" width="30" height="8" fill="#6b5b45" rx="2"/>
        <circle cx="50" cy="32" r="25" fill="#6b5b45"/>
        <ellipse cx="40" cy="30" rx="8" ry="6" fill="#1a1a1a"/>
        <ellipse cx="60" cy="30" rx="8" ry="6" fill="#1a1a1a"/>
        <circle cx="40" cy="30" r="4" fill="${n}"/>
        <circle cx="60" cy="30" r="4" fill="${n}"/>
        <rect x="38" y="45" width="24" height="8" fill="#4a4a4a" rx="2"/>
      `;break;case"serpentine":r=`
        <!-- Serpentyn -->
        <ellipse cx="50" cy="70" rx="20" ry="24" fill="#1a5a1a"/>
        <path d="M 35 75 Q 25 85 30 95" stroke="#228b22" stroke-width="8" fill="none"/>
        <circle cx="50" cy="30" r="24" fill="#228b22"/>
        <ellipse cx="40" cy="28" rx="6" ry="10" fill="#ffff00"/>
        <ellipse cx="60" cy="28" rx="6" ry="10" fill="#ffff00"/>
        <ellipse cx="40" cy="30" rx="2" ry="6" fill="#000"/>
        <ellipse cx="60" cy="30" rx="2" ry="6" fill="#000"/>
        <path d="M 45 45 Q 50 52 55 45" stroke="#1a1a1a" stroke-width="2" fill="none"/>
        <path d="M 48 48 L 50 55 L 52 48" fill="#ff0000"/>
      `;break;case"nindroid":r=`
        <!-- Nindroid -->
        <rect x="32" y="55" width="36" height="35" fill="#303030" rx="4"/>
        <rect x="38" y="60" width="24" height="3" fill="#00ff00" opacity="0.5"/>
        <rect x="38" y="66" width="24" height="3" fill="#00ff00" opacity="0.5"/>
        <circle cx="50" cy="30" r="22" fill="#404040"/>
        <rect x="30" y="25" width="40" height="15" fill="#505050" rx="2"/>
        <rect x="35" cy="28" width="12" height="8" fill="#ff0000"/>
        <rect x="53" cy="28" width="12" height="8" fill="#ff0000"/>
        <rect x="45" y="40" width="10" height="3" fill="#606060"/>
      `;break;case"ghost":r=`
        <!-- Duch -->
        <ellipse cx="50" cy="65" rx="25" ry="30" fill="#00ff88" opacity="0.6"/>
        <path d="M 25 70 Q 30 95 40 90 Q 50 95 60 90 Q 70 95 75 70" fill="#00ff88" opacity="0.6"/>
        <circle cx="50" cy="35" r="22" fill="#00ff88" opacity="0.8"/>
        <ellipse cx="40" cy="33" rx="8" ry="10" fill="#000"/>
        <ellipse cx="60" cy="33" rx="8" ry="10" fill="#000"/>
        <circle cx="42" cy="32" r="3" fill="#00ffff"/>
        <circle cx="62" cy="32" r="3" fill="#00ffff"/>
        <ellipse cx="50" cy="50" rx="8" ry="6" fill="#000" opacity="0.5"/>
      `;break;case"oni":r=`
        <!-- Oni -->
        <ellipse cx="50" cy="70" rx="26" ry="22" fill="#4a0000"/>
        <circle cx="50" cy="32" r="26" fill="#8b0000"/>
        <!-- Rogi -->
        <path d="M 30 20 L 25 5 L 35 15" fill="#1a1a1a"/>
        <path d="M 70 20 L 75 5 L 65 15" fill="#1a1a1a"/>
        <ellipse cx="38" cy="30" rx="8" ry="6" fill="#ffff00"/>
        <ellipse cx="62" cy="30" rx="8" ry="6" fill="#ffff00"/>
        <circle cx="38" cy="30" r="3" fill="#000"/>
        <circle cx="62" cy="30" r="3" fill="#000"/>
        <rect x="35" y="45" width="30" height="10" fill="#1a1a1a" rx="2"/>
        <rect x="40" y="47" width="5" height="8" fill="#fff"/>
        <rect x="48" y="47" width="5" height="8" fill="#fff"/>
        <rect x="56" y="47" width="5" height="8" fill="#fff"/>
      `;break;case"dragon-hunter":r=`
        <!-- ≈Åowca Smok√≥w -->
        <ellipse cx="50" cy="70" rx="24" ry="20" fill="#5c4033"/>
        <rect x="35" y="55" width="30" height="12" fill="#8b4513"/>
        <circle cx="50" cy="32" r="22" fill="#deb887"/>
        <ellipse cx="40" cy="30" rx="5" ry="6" fill="#1a1a1a"/>
        <ellipse cx="60" cy="30" rx="5" ry="6" fill="#1a1a1a"/>
        <circle cx="40" cy="30" r="2" fill="${n}"/>
        <circle cx="60" cy="30" r="2" fill="${n}"/>
        <!-- He≈Çm -->
        <path d="M 28 25 Q 50 5 72 25" fill="#404040"/>
        <rect x="70" y="20" width="8" height="50" fill="#8b4513"/>
        <path d="M 78 20 L 85 15 L 78 30" fill="#808080"/>
      `;break;case"overlord":r=`
        <!-- Overlord -->
        <ellipse cx="50" cy="68" rx="30" ry="26" fill="#0a0015"/>
        <circle cx="50" cy="30" r="28" fill="#1a0033"/>
        <!-- Korona cieni -->
        <path d="M 22 20 L 30 0 L 38 15 L 50 -5 L 62 15 L 70 0 L 78 20" fill="#4a0080"/>
        <ellipse cx="38" cy="28" rx="10" ry="8" fill="#8b00ff"/>
        <ellipse cx="62" cy="28" rx="10" ry="8" fill="#8b00ff"/>
        <circle cx="38" cy="28" r="4" fill="#ff00ff"/>
        <circle cx="62" cy="28" r="4" fill="#ff00ff"/>
        <!-- Trzecie oko -->
        <ellipse cx="50" cy="15" rx="6" ry="5" fill="#ff0000"/>
        <circle cx="50" cy="15" r="2" fill="#000"/>
        <path d="M 35 50 Q 50 60 65 50" stroke="#8b00ff" stroke-width="3" fill="none"/>
      `;break;default:r=`
        <ellipse cx="50" cy="72" rx="22" ry="18" fill="#2d2d2d"/>
        <circle cx="50" cy="32" r="22" fill="#e8e8e8"/>
        <circle cx="40" cy="30" r="3" fill="${n}"/>
        <circle cx="60" cy="30" r="3" fill="${n}"/>
      `}return`
    <svg viewBox="0 0 100 100" width="${a}" height="${a}" class="enemy-svg ${e.isBoss?"boss":""}">
      <!-- T≈Ço z efektem glow dla boss√≥w -->
      <circle cx="50" cy="50" r="48" fill="${e.color}" opacity="${i}"/>
      ${e.isBoss?`<circle cx="50" cy="50" r="48" fill="none" stroke="${e.color}" stroke-width="2" opacity="0.6"/>`:""}
      
      ${r}
      
      <!-- Emoji -->
      <text x="50" y="95" text-anchor="middle" font-size="${e.isBoss?18:14}">${e.emoji}</text>
    </svg>
  `}function Se(){Je.innerHTML=I.map(e=>{const t=Te(e.id),a=e.id===o.difficulty.id,n=e.disableIdleTimer?'<span class="no-timer-badge">‚àû Bez limitu czasu!</span>':"",i=e.isCustom,r=i?'<span class="custom-badge">‚öôÔ∏è Kliknij aby skonfigurowaƒá</span>':"";return`
    <button 
      class="difficulty-btn ${a?"selected":""} ${i?"custom-difficulty":""}"
      data-difficulty-id="${e.id}"
      style="--ninja-color: ${t.color}"
    >
      <div class="difficulty-ninja-avatar">
        ${ie(t,60)}
      </div>
      <div class="difficulty-info">
        <span class="difficulty-name">${e.namePolish}</span>
        <span class="difficulty-ninja-name">${t.emoji} ${t.name}</span>
        <span class="difficulty-desc">${e.description}</span>
        <span class="difficulty-ability">‚ú® ${t.abilityName}: ${t.abilityDescription}</span>
        ${n}
        ${r}
      </div>
    </button>
  `}).join("")}function pa(){Se(),Wt.textContent=String(o.highScore),document.documentElement.style.setProperty("--current-ninja-color",o.currentNinja.color)}function ga(){ae.textContent=String(o.score),ne.textContent=String(o.enemiesDefeated),oe(),p.innerHTML=ie(o.currentNinja,120);const e=k(o.enemyLevel,o.storyPath);f.innerHTML=R(e,120),G(e),rt(e.id),o.currentProblem&&(w.textContent=Q(o.currentProblem)),x(),H.textContent="",H.className="feedback",T.textContent="",Qe.textContent="",Xe.textContent="",$.className="battle-effect",m.value="",m.focus(),ct()}function x(){const e=o.playerHealth/o.maxPlayerHealth*100,t=o.enemyHealth/o.maxEnemyHealth*100;P.style.width=`${e}%`,D.style.width=`${t}%`,de.textContent=`${o.playerHealth}/${o.maxPlayerHealth}`,me.textContent=`${o.enemyHealth}/${o.maxEnemyHealth}`,P.classList.remove("health-high","health-medium","health-low","health-critical","low-health","critical"),D.classList.remove("health-high","health-medium","health-low","health-critical","low-health","critical");const a=(n,i)=>{i>60?n.classList.add("health-high"):i>40?n.classList.add("health-medium"):i>25?(n.classList.add("health-low"),n.classList.add("low-health")):(n.classList.add("health-critical"),n.classList.add("low-health"),n.classList.add("critical"))};a(P,e),a(D,t),P.classList.add("animating"),D.classList.add("animating"),de.classList.add("changed"),me.classList.add("changed"),setTimeout(()=>{P.classList.remove("animating"),D.classList.remove("animating"),de.classList.remove("changed"),me.classList.remove("changed")},300)}function wa(){const e=o.currentNinja,t=Math.min(o.streak,5),a=u.STREAK_BONUS_DAMAGE+e.streakBonus;return u.PLAYER_ATTACK_DAMAGE+e.attackBonus+t*a}function oe(){qt.textContent=String(wa())}function G(e){Ge.textContent=`${e.emoji} ${e.name}`,Ge.classList.toggle("boss-name",e.id==="boss")}function Y(e,t,a=!1){const n=e==="player"?Qe:Xe;n.textContent=a?`+${t}`:`-${t}`,n.className=`damage-popup ${a?"heal":"damage"} show`,setTimeout(()=>{n.classList.remove("show")},1e3)}function xe(e){$.className=`battle-effect ${e}-attack`,e==="player"?(p.classList.add("attacking"),f.classList.add("hit")):(f.classList.add("attacking"),p.classList.add("hit")),setTimeout(()=>{$.className="battle-effect",p.classList.remove("attacking","hit"),f.classList.remove("attacking","hit")},500)}function ba(e,t,a){H.textContent=e?"‚úì Dobrze!":`‚úó ≈πle! Poprawna odpowied≈∫: ${a}`,H.className=`feedback ${e?"correct":"incorrect"}`,T.textContent=t,T.className=`ninja-message ${e?"encouragement":"comfort"}`}function st(){N(),Qt.textContent=String(o.score),Xt.textContent=String(o.correctAnswers),ea.textContent=String(o.enemiesDefeated),z.classList.add("hidden"),ge.classList.remove("hidden"),te("Koniec gry. Spr√≥buj ponownie!",{rate:.9,pitch:.8})}function ka(){N(),o.isGameOver=!0,na.textContent=String(o.score),ia.textContent=String(o.correctAnswers),oa.textContent=String(o.enemiesDefeated),z.classList.add("hidden"),ke.classList.remove("hidden"),te("Zwyciƒôstwo! Pokona≈Çe≈õ Overlorda! Jeste≈õ prawdziwym ninja!",{rate:1,pitch:1.2})}function ct(){if(N(),o.difficulty.disableIdleTimer){const t=document.getElementById("idle-timer");t&&(t.style.display="none");return}const e=document.getElementById("idle-timer");e&&(e.style.display="block"),V=window.setInterval(()=>{At(o)&&xa()},100),W=window.setInterval(()=>{va()},50)}function N(){V&&(clearInterval(V),V=null),W&&(clearInterval(W),W=null)}function va(){if(!o.isGameActive||o.isGameOver||o.difficulty.disableIdleTimer){ue.style.width="100%";return}const e=Date.now()-o.lastAnswerTime,t=qe(o.enemyLevel,o.currentNinja.idleTimeBonus),a=Math.max(0,100-e/t*100);ue.style.width=`${a}%`,ue.classList.toggle("danger",a<=30)}function xa(){const e=Et(o);o=e.state,e.attacked&&(l("hit"),xe("enemy"),Y("player",e.damage),x(),T.textContent="Zbyt wolno! Wr√≥g atakuje!",T.className="ninja-message comfort",e.playerDefeated&&(l("gameOver"),st()))}function za(){S.forEach(t=>t.remove()),S=[],document.body.style.background="linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 50%, var(--bg-light) 100%)";const e=document.querySelector(".vignette-overlay");e&&e.remove()}function j(e){e==="start"?(N(),za(),Re.classList.remove("hidden"),z.classList.add("hidden"),ge.classList.add("hidden"),ke.classList.add("hidden"),pa()):(Re.classList.add("hidden"),ge.classList.add("hidden"),ke.classList.add("hidden"),z.classList.remove("hidden"),ga())}Je.addEventListener("click",e=>{const a=e.target.closest(".difficulty-btn");if(!a)return;const n=a.dataset.difficultyId;if(n){if(n==="custom"){Ta();return}o=ee(o,n),Se(),document.documentElement.style.setProperty("--current-ninja-color",o.currentNinja.color)}});function Ta(){const e=Tt();Z.value=String(e.maxNumber),et.textContent=String(e.maxNumber),ve.checked=e.operators.includes("+"),tt.checked=e.operators.includes("-"),at.checked=e.operators.includes("*"),nt.checked=e.operators.includes("/"),it.checked=e.disableIdleTimer,U.classList.remove("hidden")}function Le(){U.classList.add("hidden")}function ja(){const e=[];ve.checked&&e.push("+"),tt.checked&&e.push("-"),at.checked&&e.push("*"),nt.checked&&e.push("/"),e.length===0&&(e.push("+"),ve.checked=!0);const t={maxNumber:parseInt(Z.value,10),operators:e,disableIdleTimer:it.checked};xt(t),X({highScore:o.highScore,selectedNinjaId:o.currentNinja.id,selectedDifficultyId:"custom",customDifficulty:t}),o=ee(o,"custom"),Se(),document.documentElement.style.setProperty("--current-ninja-color",o.currentNinja.color),Le()}Z.addEventListener("input",()=>{et.textContent=Z.value});ca.addEventListener("click",ja);la.addEventListener("click",Le);U.addEventListener("click",e=>{e.target===U&&Le()});Yt.addEventListener("click",()=>{l("start"),o=Ee(o),j("game"),setTimeout(()=>{Ae(_t)},500)});Ft.addEventListener("click",()=>{l("click"),N(),o.isGameActive=!1,j("start")});function Me(){if(o.isGameOver)return;const e=parseInt(m.value,10);if(isNaN(e)){L.classList.add("shake"),setTimeout(()=>L.classList.remove("shake"),500);return}const t=o.currentProblem?.correctAnswer,a=jt(o,e);if(o=a.state,a.playerAttacked){l("correct"),l("attack"),O("hit"),xe("player"),Y("enemy",a.damageDealt),p.classList.add("power-up"),setTimeout(()=>p.classList.remove("power-up"),500);const n=p.getBoundingClientRect();Ze(o.currentNinja.id,n.left+n.width/2,n.top+n.height/2),o.streak>=2&&(ma(o.streak,o.currentNinja.id),o.streak>=5&&O("combo")),o.streak===5&&(ua(),J()),a.isCorrect&&setTimeout(()=>Y("player",5,!0),300);const i=f.getBoundingClientRect();da(i.left+i.width/2,i.top+i.height/2,o.currentNinja.color,8)}else a.enemyAttacked&&(l("wrong"),l("hit"),O("damage"),xe("enemy"),Y("player",a.damageTaken),ot(),o.playerHealth<=30&&(p.classList.add("critical-hit"),setTimeout(()=>p.classList.remove("critical-hit"),300)));if(x(),ba(a.isCorrect,a.message,t),ae.textContent=String(o.score),ne.textContent=String(o.enemiesDefeated),oe(),a.enemyDefeated&&(l("victory"),$.classList.add("enemy-defeated"),f.classList.add("enemy-death"),setTimeout(()=>{$.classList.remove("enemy-defeated"),f.classList.remove("enemy-death")},1e3),a.newEnemyType?setTimeout(()=>{const n=k(o.enemyLevel,o.storyPath);rt(n.id),n.isBoss?(ya(n),f.innerHTML=R(n,120),G(n),x()):(f.classList.add("enemy-spawn"),f.innerHTML=R(n,120),G(n),x(),T.textContent=`Nowy przeciwnik: ${n.emoji} ${n.name}!`,setTimeout(()=>{f.classList.remove("enemy-spawn")},600))},800):(fa("OVERLORD"),J(),setTimeout(()=>{Ae({emoji:"üèÜ",text:`ZWYCIƒòSTWO!

Pokona≈Çe≈õ Overlorda i uratowa≈Çe≈õ Ninjago!

Jeste≈õ prawdziwym MISTRZEM SPINJITZU!

‚ö° Twoja mƒÖdro≈õƒá matematyczna ocali≈Ça krainƒô! ‚ö°`},()=>{ka()})},500))),a.playerDefeated){l("gameOver"),st();return}if(o.currentProblem&&!o.isGameOver){B&&(clearTimeout(B),B=null);const n=o.currentProblem,i=Q(n);w.classList.remove("problem-exit","problem-enter"),w.classList.add("problem-exit"),B=window.setTimeout(()=>{w.textContent=i,w.classList.remove("problem-exit"),w.classList.add("problem-enter"),setTimeout(()=>w.classList.remove("problem-enter"),300),B=null},150)}m.value="",L.textContent="?",setTimeout(()=>{H.textContent="",T.textContent=""},1e3)}function _(){L.textContent=m.value||"?"}Ut.addEventListener("click",e=>{const t=e.target,a=t.closest(".numpad-btn"),n=t.dataset.num;n!==void 0&&!o.isGameOver&&(l("click"),O("tap"),a&&(a.classList.add("numpad-pressed"),setTimeout(()=>a.classList.remove("numpad-pressed"),150)),m.value.length<4&&(m.value+=n,_()))});Zt.addEventListener("click",()=>{!o.isGameOver&&m.value.length>0&&(l("click"),O("tap"),m.value=m.value.slice(0,-1),_())});Jt.addEventListener("click",()=>{o.isGameOver||Me()});document.addEventListener("keydown",e=>{if(e.key==="`"||e.key==="~"){o.isGameActive&&!o.isGameOver&&(e.preventDefault(),ha());return}!o.isGameActive||o.isGameOver||z.classList.contains("hidden")||(e.key>="0"&&e.key<="9"?m.value.length<4&&(m.value+=e.key,_(),l("click")):e.key==="Backspace"?m.value.length>0&&(m.value=m.value.slice(0,-1),_(),l("click")):e.key==="Enter"&&Me())});ta.addEventListener("click",()=>{l("start");const e=o.currentNinja,t=o.difficulty;o=je(),o=Fe(o,e.id),o=ee(o,t.id),o=Ee(o),w.textContent=Q(o.currentProblem),ae.textContent="0",ne.textContent="0",oe(),p.innerHTML=ie(o.currentNinja,120),document.documentElement.style.setProperty("--current-ninja-color",o.currentNinja.color),x();const a=k(o.enemyLevel,o.storyPath);f.innerHTML=R(a,120),G(a),j("game"),m.value="",L.textContent="?"});aa.addEventListener("click",()=>{l("click"),j("start")});ra.addEventListener("click",()=>{l("start");const e=o.currentNinja,t=o.difficulty;o=je(),o=Fe(o,e.id),o=ee(o,t.id),o=Ee(o),w.textContent=Q(o.currentProblem),ae.textContent="0",ne.textContent="0",oe(),p.innerHTML=ie(o.currentNinja,120),document.documentElement.style.setProperty("--current-ninja-color",o.currentNinja.color),x();const a=k(o.enemyLevel,o.storyPath);f.innerHTML=R(a,120),G(a),j("game"),m.value="",L.textContent="?"});sa.addEventListener("click",()=>{l("click"),j("start")});function lt(){we.textContent=pe()?"üîá":"üîä",we.setAttribute("aria-label",pe()?"W≈ÇƒÖcz d≈∫wiƒôki":"Wycisz d≈∫wiƒôki")}function dt(){be.textContent=Ie()?"üó£Ô∏è":"ü§ê",be.setAttribute("aria-label",Ie()?"Wy≈ÇƒÖcz g≈Ços":"W≈ÇƒÖcz g≈Ços")}we.addEventListener("click",()=>{Ht(),lt(),pe()||l("click")});be.addEventListener("click",()=>{Gt(),dt()});function Ea(){lt(),dt(),j("start")}Ea();
